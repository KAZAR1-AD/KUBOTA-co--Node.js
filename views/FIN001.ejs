<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- ページタイトル: サーバーから渡されなければデフォルトを表示 -->
    <title><%= typeof pageTitle !== 'undefined' ? pageTitle : '船橋今なにする？' %></title>
    <!-- CSSのパスは /css/... が正解です -->
    <link rel="stylesheet" href="/css/style.css"> 
</head>
<body class="fin001">

    <header class="fixed-header">
        <div class="fixed-header-left">
            </div>
        <div class="fixed-header-title">船橋今なにする？</div>
        <div class="fixed-header-icon-area">

            <% if (isLoggedIn) { %>
                <div class="fin001-user-controls">
                    <span class="fin001-welcome-msg"><%= userName %>さん</span>
                    
                    <a href="/mypage" class="header-profile-icon">
                        <!-- 修正箇所: サーバーから渡された userIconUrl を直接 src に設定 -->
                        <img id="headerProfileImage" src="<%= userIconUrl %>" alt="メニュー">
                    </a>    
                    <form action="/logout" method="POST" style="display: inline;" onsubmit="return confirm('ログアウトしますか？');">
                        <button type="submit" class="btn btn-default fin001-logout-btn">ログアウト</button>
                    </form>
                </div>

            <% } else { %>
                <a href="/FIN002?returnUrl=<%= currentUrl %>" class="btn btn-default header-login-btn" role="button" id="headerLoginBtn">      
                    ログイン
                </a>
                <a href="/FIN003" class="btn btn-default fin006-register-btn" role="button">
                    新規登録
                </a>
            <% } %>
        </div>
    </header>

    <main>
        <div class="container fin001-main-container">
            <h1>こんにちは！</h1>
            <div class="button-area button-area-center">
                <a href="/search" class="btn btn-primary fin001-start-btn">
                    はじめる
                </a>
            </div>
        </div>
    </main>

    <!-- プロフィール画像の処理（LocalStorage対応） -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // サーバー側でログイン判定ができているので、ここでの複雑な分岐は不要ですが、
            // 「画像URL」だけはLocalStorageから取ってくる必要がある場合の処理
            const savedImageUrl = localStorage.getItem('profileImage');
            const profileImgTag = document.getElementById('ejsProfileImage');

            // ログインしていて、かつ画像タグがあり、かつ保存された画像がある場合
            if (profileImgTag && savedImageUrl) {
                profileImgTag.src = savedImageUrl;
            }
        });
    </script>
</body>
</html>