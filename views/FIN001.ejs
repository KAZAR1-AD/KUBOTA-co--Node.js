<!DOCTYPE html>
<html lang="ja">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>
    <%= pageTitle || '船橋今なにする？（FIN001）' %>
  </title>
  <link rel="stylesheet" href="/css/style.css">

</head>

<body class="fin001">

  <header class="fin001-header fixed-header">
    <div class="fixed-header-title">船橋今なにする？</div>

    <% if (isLoggedIn) { %>
      <div class="fin001-user-controls">

        <span class="fin001-welcome-msg">ようこそ、<%= userName %>さん！</span>

        <a href="/mypage" class="header-profile-icon">
          <img id="headerProfileImage" src="" alt="メニュー">
        </a>

        <a href="/FIN009" class="btn btn-default fin001-setting-btn" role="button">
          個人設定
        </a>

        <form action="/logout" method="POST" style="display: inline;">
          <button type="submit" class="btn btn-default fin001-login-btn">
            ログアウト
          </button>
        </form>
      </div>

      <% } else { %>
        <a href="/FIN002" class="btn btn-default fin001-login-btn" role="button" id="headerLoginBtn">
          ログイン
        </a>
        <% } %>
  </header>

  <div class="container fin001-main-container">
    <h1>船橋今なにする？</h1>
    <div class="button-area button-area-center">
      <a href="/search" class="btn btn-primary fin001-start-btn">はじめる</a>
    </div>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', function () {
      const isLoggedIn = <%= isLoggedIn %>;
      const savedImageUrl = localStorage.getItem('profileImage');
      const headerProfileImage = document.getElementById('headerProfileImage');
      const loginBtn = document.getElementById('headerLoginBtn');

      // ログイン状態に応じたアイコンの処理
      if (isLoggedIn) {
        if (headerProfileImage) {
          // ログインしている場合、アイコンのsrcを設定
          const imageUrl = savedImageUrl || '/images/user_icon/sample.png';
          headerProfileImage.src = imageUrl;
        }
      } else {
        // 非ログイン時のログインボタンのリダイレクト処理
        if (loginBtn) {
          loginBtn.addEventListener('click', function (e) {
            e.preventDefault();
            const currentUrl = window.location.href;
            // ログイン後、このページに戻るためのURLを保存
            localStorage.setItem('redirectUrl', currentUrl);
            window.location.href = e.target.href;
          });
        }
      }
    });
  </script>

</body>

</html>