<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>検索結果（FIN007）</title>
    <link rel="stylesheet" href="/css/style.css"> 
</head>
<body class="fin007">

    <div class="fin007-title-bar" style="text-align: center; display: flex; justify-content: center; width: 100%;">
        <h2>検索結果</h2>
    </div>

    <div class="fin007-results-container">

        <% if (!shop || shop.length === 0) { %>
            <div style="text-align: center; padding: 20px;">
                <p>条件に合うお店が見つかりませんでした。</p>
            </div>
        <% } else { %>
            
            <% shop.forEach(item => { %>
            <div class="fin007-result-item">
                <span class="fin007-result-info">
                    <%= item.shop_name %> 
                    徒歩<%= Math.ceil(item.distance / 80) %>分<%= item.distance < 80 ? '以内' : '' %> 
                    予算：<%= item.budget %>円
                </span>
                <% if (isLoggedIn) { %>
                    <span class="fin007-result-star">
                        <img class="toggle-star"
                            src="<%= item.user_id !== null ? '/images/star.png' : '/images/star-bw.png' %>"
                            data-on="/images/star.png"
                            data-off="/images/star-bw.png"
                            alt="<%= item.user_id !== null ? 'お気に入りから削除' : 'お気に入りに追加' %>">
                    </span>
                <% } %>
            </div>
            <% }); %>

        <% } %>


        <% if (typeof totalPages !== 'undefined' && totalPages > 1) { %>
        <div class="pagination-container">
            <nav class="pagination">
                
                <% if (currentPage > 1) { %>
                    <a href="/search-results?page=<%= currentPage - 1 %>" class="pagination-link">
                        &laquo; 前へ
                    </a>
                <% } else { %>
                    <span class="pagination-link disabled">&laquo; 前へ</span>
                <% } %>


                <% for(let i = 1; i <= totalPages; i++) { %>
                    <% if (i === currentPage) { %>
                        <span class="pagination-link active"><%= i %></span>
                    <% } else { %>
                        <a href="/search-results?page=<%= i %>" class="pagination-link">
                            <%= i %>
                        </a>
                    <% } %>
                <% } %>


                <% if (currentPage < totalPages) { %>
                    <a href="/search-results?page=<%= currentPage + 1 %>" class="pagination-link">
                        次へ &raquo;
                    </a>
                <% } else { %>
                    <span class="pagination-link disabled">次へ &raquo;</span>
                <% } %>

            </nav>
        </div>
        <% } %>

    </div>

    <a href="/search" class="fin007-change-criteria-btn">
        条件<br>を変える
    </a>

    <script>
        document.querySelectorAll(".toggle-star").forEach(img => {
            img.addEventListener("click", () => {
                const onImg  = img.dataset.on;
                const offImg = img.dataset.off;

                const altOn  = "お気に入りから削除";
                const altOff = "お気に入りに追加";

                if (img.src.includes(offImg)) {
                    img.src = onImg;
                    img.alt = altOn;
                } else {
                    img.src = offImg;
                    img.alt = altOff;
                }
            });
         });
    </script>
    
</body>
</html>